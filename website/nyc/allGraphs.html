<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" name="viewport" content="initial-scale=1.0, user-scalable=no"/>
        <title>A Bunch of Graphs</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <style type="text/css">
			html, body {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
			}
			
			.axis path, .axis line {
				fill: none;
				stroke: #000;
				shape-rendering: crispEdges;
			}

			.tooltip {
				background-color:#ffffff;
				border:1px solid;
				position: absolute;
				width: 200px;
				height: 45px;
				pointer-events: none;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript">
        	var totalWidth = document.getElementsByTagName("body")[0].offsetWidth-20;
        	var totalHeight = document.getElementsByTagName("body")[0].offsetHeight-20;
        
			var margin = {top: 20, right: 20, bottom: 30, left: 40};
			var width = totalWidth - margin.left - margin.right;
			var height = totalHeight - margin.top - margin.bottom;
			
			var tooltip = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);
			
            d3.json("../../data/nyc/stations.json", function(data) {
            	console.log(data);
            	data.sort(function(a, b) {
                	return b["totalDocks"] - a["totalDocks"];
                });
            	
            	var xValue = function(d) {return d["totalDocks"];};
	            var xScale = d3.scale.linear()
	                .domain([
	                    d3.min(data, function(d) {
	                        return parseInt(d["totalDocks"]);
                        })-1,
	                    d3.max(data, function(d) {
	                        return parseInt(d["totalDocks"]);
	                    })+1])
	                .range([0, width]);
	            var xMap = function(d) {return xScale(xValue(d));};
                var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
	            
	            var yValue = function(d) {return d["request"];};
                var yScale = d3.scale.linear()
	                .domain([
	                    d3.min(data, function(d) {
	                        return parseInt(d["request"]);
	                    })-1,
	                    d3.max(data, function(d) {
	                        return parseInt(d["request"]);
	                    })+1])
	                .range([height, 0]);
                var yMap = function(d) {return yScale(yValue(d));};
                var yAxis = d3.svg.axis().scale(yScale).orient("left");
	                
                var svg = d3.select("body").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	                
                //x-axis
                svg.append("g")
                	.attr("class", "x axis")
                	.attr("transform", "translate(0,"+height+")")
                	.call(xAxis)
                	.append("text")
                	.attr("class", "label")
                	.attr("x", width)
                	.attr("y", -6)
                	.style("text-anchor", "end")
                	.text("Total Docks");
                	
                //y-axis
                svg.append("g")
                	.attr("class", "y axis")
                	.call(yAxis)
                	.append("text")
                	.attr("class", "label")
                	.attr("y", 6)
                	.attr("dy", "0.71em")
                	.style("text-anchor", "end")
                	.text("Request Value");
                	
                	
            	svg.selectAll(".dot")
            		.data(data)
            		.enter().append("circle")
            		.attr("class", "dot")
            		.attr("r", 3.5)
            		.attr("cx", xMap)
            		.attr("cy", yMap)
					.on("mouseover", function(d) {
						tooltip.transition()
							.duration(200)
							.style("opacity", 1.0);
						tooltip.html("Station "+d["id"] + "<br/> (" + xValue(d) 
						+ ", " + yValue(d) + ")")
							.style("left", (d3.event.pageX + 5) + "px")
							.style("top", (d3.event.pageY - 40) + "px");
					})
					.on("mouseout", function(d) {
						tooltip.transition()
							.duration(500)
							.style("opacity", 0);
					});
            });
        </script>
    </body>
</html>